# Instructions

## Generate PRD from wireframe

根据 @specs/w7/genslide.jpg 的内容，仔细阅读并思考，生成一个 ./specs/w7/0001-prd.md 的 PRD。要求：使用中文。这个 app 是一个本地运行的单页 app，使用 nano banana pro 生成图片 slides，可以以走马灯的形式全屏播出。后端使用 Python，前端使用 Typescript。

## PRD modifications

specs/w7/0001-prd.md 需要修改：

1. 图片生成使用 google ai sdk
2. 对于侧边栏 slide，选中并拖拽可以改变顺序
3. 文本内容变化后，如果图片中没有对应文本hash的图片，在主图片区域下放一个按钮，用户点击可以生成新的图片
4. outline.yml 中需要保存用户选择的风格图片。当第一次打开时，如果没有风格图片，需要有个 popup，用户可以输入一段文字，生成两个图片，让用户选择，用户选中的作为 slides 的风格，以后生成新的图片时参考这张图片
5. Nano Banana Pro API key -> Gemini API key

outline 里的 style 包含：prompt 和 image，不要仅保存 style_image

## Generate design spec

根据 ./specs/w7/0001-prd.md 和 @specs/w7/genslide.jpg 的内容，生成一个 design spec，放在 ./specs/w7/0002-design-spec.md 文件中。要求：使用中文，注意所有前端所需的 API 接口要定义清楚。整体项目的目录结构也要定义清楚，后端代码层次清晰，API/业务/存储要保持清晰的边界。

## Google AI SDK usage

google ai SDK 使用：<https://ai.google.dev/gemini-api/docs/image-generation，其中核心代码：>

```python
from google import genai
from google.genai import types
from PIL import Image
client = genai.Client()
prompt = ("Create a picture of a nano banana dish in a fancy restaurant with a Gemini theme")
response = client.models.generate_content(
    model="gemini-3-pro-image-preview",
    contents=[prompt],
    config=types.GenerateContentConfig(
        image_config=types.ImageConfig(
            aspect_ratio="16:9",
            image_size="2K",
        )
    )
)
for part in response.parts:
    if part.text is not None:
        print(part.text)
    elif part.inline_data is not None:
        image = part.as_image()
        image.save("generated_image.png")
```

这里 nano banana pro 的模型名：gemini-3-pro-image-preview，更新 design spec

## Project setup

注意项目使用 uv 所有的 dep 管理和命令都使用 uv

不用，就按照 example 使用 PIL 吧。请确保所有的 dep 都是最新版本

## Generate project structure

根据 ./specs/w7/0002-design-spec.md 的内容，生成项目的空的目录结构。先不要生成代码。在 backend/ 和 frontend/ 目录下分别生成 CLAUDE.md 文件，内容考虑：

- 所使用语言框架的 best practices
- 架构设计遵循的原则：SOLID/YAGNI/KISS
- 代码的组织结构
- 并发处理
- 错误处理和日志处理

## Implement backend and frontend

根据 @specs/w7/0002-design-spec.md 的内容，启动 python 和 typescript 两个 agent 分别撰写后端和前端的代码。代码在 ./w7/genslides 下。

## Fix API issues

创建风格图片出错：POST /api/slides/gen-slides/style/generate HTTP/1.1 404 Not Found

请仔细阅读前后端代码，确保他们 API 的实现符合 ./specs/w7/0002-design-spec.md。如果是 design spec 里缺失的 API，请在 design spec 里添加，并确保前后端一致

## Frontend UI issues

目前前端界面有很大问题：

1. 没有使用 design-tokens.css 请确保使用定义好的 design tokens
2. 请再次阅读 ./specs/w7/genslide.jpg，页面结构应该跟它一致。
   - 侧边栏每个 slide 后面（下一个slide 前面）的位置点击会显示一条横线，回车可以添加新的 slide
   - 每个 slide 删除的按钮应该放在右上方

## CSS and routing fixes

不要使用 globals.css 我已经定义好 global.css 了，把相应的css 放在 global.css 中（但确保 design token）

页面使用 localhost:5174/gen-slides 这样的 url ，不要使用 query string。另外页面元素的颜色，top bar 颜色（使用design token 中的黄色）等只能使用 design token 中的，不要随便定义

## Style picker behavior

如果页面已经有 style 图片，进入时就不用显示这个popup，在右上角可以放一个按钮显示 popup 让用户查看style prompt/image，或者更新

## Slide item layout

缩略图和文字是上下结构，整个slide 可以是 16:10或者 16:11，大一些，上面显示图片，下面显示文字

双击 slide 打开一个popup 允许用户修改 slide 文本

## Image generation button

当我修改文字后，并未出现 生成的 button，请查看代码修复

感觉 button 被 image 挡住了，image 是否应该小一些，下面的空间可以放缩略图，和创建图片的button

缩略图应该居中。现在虽然可见，但图片被截断不好看。缩略图居中浮在图片上。generate image 不需要了，其功能放在缩略图列表即可：当文字和图片没有匹配时，显示 + button（tooltip：生成当前文字的图片）

## Image selection and persistence

页面侧边栏的图片展示选中的图片

选中图片后，它成为缺省图片，保存在 outline.yml 中，播放时使用缺省的（缺省图片：选中 > hash > 最近)

priority 3 应该是最新的 image

1. 选择图片后，还是没有保存，刷新就丢失
2. 在页面打开时，还会弹出 popup，但此时 slide 已经设置过 style 了；点击 style 按钮，popup 里也没显示已经保存的 style

选择 image 后保存，但在前端页面里似乎没有使用，请仔细检查前端的实现是否正确加载应该使用的图片

play 时使用的 image 不对

make sure DRY

## UI refinements

edit slides popup 再大一些，这样输入起来更加方便

可能因为正在生成图片被阻塞，需要确保前后端都是异步无阻塞完成

在生成图片的时候，无法切换 slides

thumbnail 整个列表放在 image 右侧从上到下排列，大小稍微大一些

右侧垂直居中

thumbnail一半可以和 image overlap

页码放在整个section 的右下角，而非image 的右下角，另外，不需要背景颜色

## Fullscreen player fixes

play 时会丢失一些纵向的信息，image 没有显示全。另外，不要自动跳到下一页；到达最后一页后，继续翻页停止播放

还是不对，不要这样用 css - 试试高度充满即可

## Commit

commit and push code

## 页面风格

使用浅黄色 / 红褐色的水彩画风格，走可爱卡通路线，主要角色是一只黄色的可爱的鸭子，类似 motherduck 的风格
