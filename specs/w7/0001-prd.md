# GenSlides - AI 图片幻灯片生成器

## 概述

GenSlides 是一个本地运行的单页应用，用于生成和展示 AI 图片幻灯片。用户可以编写文字描述，系统使用 Google AI SDK（Gemini）生成对应的图片，并以走马灯（轮播）的形式全屏播放。

## 目标

1. 支持流畅的 slides 生成，提供纯视觉的演示方案
2. 图片生成可以并行处理，slides 之间互不影响（基准图需要先生成）
3. 注意成本控制（展示当前 slides 的总体生成成本）

## 非目标

1. 导出成 pptx 格式
2. 用户权限管理
3. 数据库存储

## 技术架构

### 后端
- **语言**：Python
- **框架**：FastAPI
- **图片生成**：Google AI SDK（Gemini）

### 前端
- **语言**：TypeScript
- **样式**：Tailwind CSS
- **状态管理**：Zustand

### 数据存储

采用文件系统存储，不使用数据库：

```
./slides/<slug>/
├── outline.yml          # 包含所有 slide 的文本信息
└── images/
    └── <sid>/
        └── <blake3_hash>.jpg   # 根据文字内容生成的图片
```

## 功能需求

### 1. URL 路由

- 访问 `http://localhost:3003/<slug>` 对应 `./slides/<slug>` 目录下的 slides
- 示例：`http://localhost:3003/hello-world` -> `./slides/hello-world/`

### 2. Slide 管理

#### 2.1 Slide 列表（左侧边栏）

- 从 `outline.yml` 读取并展示所有 slides
- 每个 slide 有一个唯一的 `sid`，关联若干图片
- **单击**：选中 slide，在右侧预览区显示对应图片
- **双击**：进入编辑模式，修改 slide 的文字内容
- **拖拽排序**：选中 slide 后可拖拽到新位置，调整 slides 的播放顺序
- **插入新 slide**：点击某个 slide 下方出现插入线，按回车在该位置创建新 slide

#### 2.2 Slide 编辑

- 支持双击进入编辑模式
- 编辑完成后自动保存到 `outline.yml`
- 文字内容变更后触发新图片生成

### 3. 图片生成与展示

#### 3.1 图片生成规则

- 根据 slide 的文字内容调用 Google AI SDK（Gemini）生成图片
- 图片保存路径：`./slides/<slug>/images/<sid>/<blake3_hash>.jpg`
  - `<blake3_hash>` 基于文字内容计算，确保相同内容不重复生成
- 一个 slide 可以生成多个图片（不同版本）

#### 3.2 图片展示规则

- 选中 slide 时，优先展示与当前文字 blake3 hash 一致的图片
- 如果没有匹配的图片，展示最新生成的一张图片
- **生成新图片按钮**：当文本内容变化后，如果没有对应文本 hash 的图片，在主图片预览区下方显示「生成新图片」按钮，用户点击后触发图片生成
- 底部显示该 slide 所有图片的缩略图，用户可切换预览

### 4. 播放模式

- 点击右上角「播放」按钮进入全屏播放模式
- 从当前选中的 slide 开始播放
- 以走马灯（轮播）形式自动切换展示所有 slides 的图片
- 支持键盘控制（左右箭头切换、ESC 退出）

### 5. 成本展示

- 在界面上展示当前 slides 的总体生成成本
- 帮助用户了解 API 调用费用

### 6. 风格图片选择

#### 6.1 首次打开流程

- 当用户首次打开一个 slides 项目（`outline.yml` 中没有 `style` 字段）时，弹出风格选择弹窗
- 弹窗内容：
  - 文字输入框：用户输入描述期望风格的文字（如"水彩画风格"、"赛博朋克科幻感"）
  - 「生成风格」按钮：点击后调用 Gemini 生成两张候选风格图片
  - 两张图片并排展示，用户点击选中其中一张作为风格参考
  - 选中后保存到 `outline.yml` 的 `style` 字段（包含 `prompt` 和 `image`）

#### 6.2 风格参考机制

- 后续生成新图片时，将风格图片作为参考一并传给 Gemini API
- 确保整个 slides 项目的图片风格保持一致

#### 6.3 风格修改

- 用户可在设置中重新选择或生成新的风格图片
- 修改风格后不影响已生成的图片

## 界面布局

```
+------------------------------------------------------------------+
| [Logo] GenSlides    [ slides 题头输入框 ]           [ 播放 ]      |
+------------------------------------------------------------------+
|                    |                                              |
|  +--------------+  |                                              |
|  |   Slide 1    |  |                                              |
|  +--------------+  |                                              |
|                    |         [ 图片预览区 ]                        |
|  +--------------+  |                                              |
|  |   Slide 2    |  |                                              |
|  +--------------+  |                                              |
|                    |                                              |
|       ...          |   +----+ +----+ +----+ +----+ +----+         |
|                    |   |缩略| |缩略| |缩略| |缩略| |缩略|         |
|                    |   +----+ +----+ +----+ +----+ +----+         |
+------------------------------------------------------------------+
```

## 数据结构

### outline.yml 示例

```yaml
title: "Hello World 演示"
style:
  prompt: "水彩画风格，柔和的色调"  # 用户输入的风格描述文字
  image: "style_abc123.jpg"          # 用户选择的风格参考图片
slides:
  - sid: "slide_001"
    content: "一只可爱的猫咪在阳光下打盹"
    created_at: "2024-01-11T10:00:00Z"
    updated_at: "2024-01-11T10:30:00Z"
  - sid: "slide_002"
    content: "星空下的山脉剪影"
    created_at: "2024-01-11T10:05:00Z"
    updated_at: "2024-01-11T10:05:00Z"
```

## API 设计

### 后端接口

| 方法 | 路径 | 描述 |
|------|------|------|
| GET | `/api/slides/{slug}` | 获取指定 slug 的 slides 列表 |
| POST | `/api/slides/{slug}` | 创建新的 slides 项目 |
| PUT | `/api/slides/{slug}/{sid}` | 更新指定 slide 内容 |
| POST | `/api/slides/{slug}/{sid}/generate` | 为指定 slide 生成图片 |
| GET | `/api/slides/{slug}/{sid}/images` | 获取指定 slide 的所有图片 |
| DELETE | `/api/slides/{slug}/{sid}` | 删除指定 slide |
| GET | `/api/cost/{slug}` | 获取当前项目的成本统计 |

## 运行环境

- 本地运行，默认端口 3003
- 不需要外部数据库
- 不需要用户认证
- 需要配置 Gemini API 密钥

## 后续扩展（待定）

- 支持自定义播放间隔时间
- 支持图片风格预设
- 支持批量导入文字内容
- 支持多种图片生成模型切换
